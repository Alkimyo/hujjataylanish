{% extends 'documents/base.html' %}

{% block title %}Kirish - Unidoc{% endblock %}

{% block content %}
<div class="login-ambient" aria-hidden="true"></div>
<div class="row justify-content-center align-items-center" style="min-height: 85vh;">
    <div class="col-12 col-md-7 col-lg-5" style="max-width: 460px;">
        
        <div class="card shadow-lg border-0 login-glass">
            <div class="card-header text-center py-4 login-header">
                <div style="font-size: 3rem; color: white; margin-bottom: 10px;">
                    <i class="bi bi-file-earmark-lock2"></i>
                </div>
                <h3 class="text-white mb-1 fw-bold">Tizimga kirish</h3>
                <p class="text-white-50 mb-0">Hujjat boshqaruv tizimi</p>
            </div>
            
            <div class="card-body p-4">
                {% if form.errors %}
                <div class="alert alert-danger alert-dismissible fade show shadow-sm" role="alert">
                    <i class="bi bi-x-circle me-2"></i> Login yoki parol noto'g'ri!
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endif %}
                
                <form method="POST" action="{% url 'login' %}" id="loginForm">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold text-muted small">Foydalanuvchi nomi</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0">
                                <i class="bi bi-person text-secondary"></i>
                            </span>
                            <input type="text" name="username" class="form-control border-start-0 ps-0" 
                                   placeholder="Login kiriting"
                                   value="{{ form.username.value|default:'' }}"
                                   style="background-color: #f8f9fa;"
                                   required autofocus>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold text-muted small">Parol</label>
                        <div class="input-group position-relative">
                            <span class="input-group-text bg-light border-end-0">
                                <i class="bi bi-lock text-secondary"></i>
                            </span>
                            <input type="password" name="password" class="form-control border-start-0 ps-0" 
                                   id="passwordField"
                                   placeholder="Parol kiriting"
                                   style="background-color: #f8f9fa;"
                                   required>
                            <span class="position-absolute end-0 top-50 translate-middle-y me-3" 
                                  style="cursor: pointer; z-index: 10;" id="togglePassword">
                                <i class="bi bi-eye text-muted"></i>
                            </span>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div class="form-check">
                            <input type="checkbox" name="remember" class="form-check-input" id="rememberMe">
                            <label class="form-check-label small user-select-none" for="rememberMe">
                                Eslab qolish
                            </label>
                        </div>
                        <a href="#" class="text-decoration-none small fw-bold" data-bs-toggle="modal" data-bs-target="#forgotPasswordModal">
                            Parolni unutdingizmi?
                        </a>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary py-2 fw-bold shadow-sm" style="border-radius: 10px;">
                            <i class="bi bi-box-arrow-in-right me-2"></i> Kirish
                        </button>
                        
                    </div>
                </form>
            </div>
            
           
        </div>
        
    </div>
</div>

<div class="modal fade" id="forgotPasswordModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius: 15px;">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold">Parolni tiklash</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted mb-3">Tizimga ulangan email manzilingizni kiriting:</p>
                <form method="POST" action="#">
                    {% csrf_token %}
                    <div class="mb-3">
                        <input type="email" name="email" class="form-control" 
                               placeholder="email@example.com" required>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary" style="border-radius: 8px;">
                            Yuborish
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .login-ambient {
        position: fixed;
        inset: 0;
        z-index: -1;
        pointer-events: none;
        background: linear-gradient(140deg, #fbfbf9 0%, #f4efe6 100%);
        overflow: hidden;
    }

    .login-ambient::before,
    .login-ambient::after {
        content: "";
        position: absolute;
        width: 55vmax;
        height: 55vmax;
        border-radius: 50%;
        filter: blur(30px);
        opacity: 0.7;
    }

    .login-ambient::before {
        top: -20vmax;
        left: -10vmax;
        background: radial-gradient(circle, rgba(15, 61, 62, 0.22), transparent 60%);
        animation: floatDrift 18s ease-in-out infinite;
    }

    .login-ambient::after {
        bottom: -25vmax;
        right: -10vmax;
        background: radial-gradient(circle, rgba(242, 166, 90, 0.28), transparent 60%);
        animation: slowOrbit 22s linear infinite;
    }

    @keyframes floatDrift {
        0% { transform: translate3d(0, 0, 0) scale(1); }
        50% { transform: translate3d(18px, 12px, 0) scale(1.04); }
        100% { transform: translate3d(0, 0, 0) scale(1); }
    }

    @keyframes slowOrbit {
        0% { transform: translate3d(0, 0, 0) rotate(0deg) scale(1); }
        50% { transform: translate3d(-16px, -10px, 0) rotate(6deg) scale(1.03); }
        100% { transform: translate3d(0, 0, 0) rotate(12deg) scale(1); }
    }

    .login-glass {
        border-radius: 18px;
        background: rgba(255, 255, 255, 0.78);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        border: 1px solid rgba(15, 61, 62, 0.12);
    }

    .login-header {
        background: linear-gradient(135deg, #0f3d3e 0%, #1b6f6f 100%);
        border-radius: 18px 18px 0 0;
    }

    /* Inputlar chiroyli ko'rinishi uchun */
    .form-control:focus {
        background-color: #fff !important;
        box-shadow: none;
        border-color: #1b6f6f;
    }
    .input-group:focus-within .input-group-text {
        background-color: #fff !important;
        border-color: #1b6f6f;
    }
    .input-group:focus-within .form-control {
        border-color: #1b6f6f;
    }
    .form-check-input:checked {
        background-color: #0f3d3e;
        border-color: #0f3d3e;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    const togglePassword = document.getElementById('togglePassword');
    const passwordField = document.getElementById('passwordField');
    
    if (togglePassword && passwordField) {
        togglePassword.addEventListener('click', function() {
            const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordField.setAttribute('type', type);
            
            const icon = this.querySelector('i');
            icon.classList.toggle('bi-eye');
            icon.classList.toggle('bi-eye-slash');
        });
    }
    
    const loginForm = document.getElementById('loginForm');
    if (loginForm) {
        loginForm.addEventListener('submit', function(e) {
            const btn = this.querySelector('button[type="submit"]');
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Kirish...';
            btn.disabled = true;
        });
    }
</script>
{% endblock %}
